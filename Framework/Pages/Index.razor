@page "/"
@using Framework.Slides
@using Framework.State
@using Framework.Game
@using Framework.Keyboard
@using Framework.Mouse
@using Framework.Sound
@using Framework.Video

@inject SlideService SlideService
@inject GameState GameState
@inject KeyboardService KeyboardService
@inject MouseService MouseService
@inject SoundService SoundService
@inject VideoService VideoService

@if (initTask.IsCompletedSuccessfully) {
    if (gameStarted) {
        <Game Debug=@debugMode />
    }
    else {
        <h1 id="test">Hello, world!</h1>
        <button style="color: white; background-color: rgb(255, 0, 0)" @onclick="StartGame">Game</button>
        <a href="/testpage">TestPage</a>
    }
}


else {
    <div style="color: white">Loading...</div>
}

@code {
    private TaskCompletionSource<bool> _tcs = new();
    private Task initTask => _tcs.Task;

    private bool gameStarted = false;

    private bool debugMode = true;

    protected override async Task OnInitializedAsync()
    {
        await GameState.LoadGameStateAndItemsAsync();
        await SlideService.Init(debugMode);
        await KeyboardService.Init();
        await MouseService.Init();
        await SoundService.Init();
        await VideoService.Init();
        _tcs.SetResult(true);
    }

    private void StartGame(){
        gameStarted = true;
    }
}